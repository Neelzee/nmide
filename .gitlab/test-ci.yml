c-test-build:
  image: neelzee/nmide-c:latest
  stage: test
  script:
    - exit
    - gcc --version
    - cmake --version
    - make --version
    - mkdir nmide-lib/debug
    - git clone https://github.com/nemequ/munit.git nmide-lib/munit
    - cd nmide-lib/debug
    - pwd
    - export CC=gcc
    - cmake -DCMAKE_BUILD_TYPE=Debug ..
    - make
    - ls
  artifacts:
    expire_in: 1 hrs
    paths:
      - nmide-lib/debug

# Tests

test-nmide-core-backend:
  image: neelzee/nmide-tauri:latest
  stage: test
  tags:
    - nmide-core
  script:
    - cargo --version
    - cd nmide-core/src-tauri
    - cargo test --workspace

test-nmide-core-frontend:
  image: neelzee/nmide-tauri:latest
  tags:
    - nmide-core
  stage: test
  script:
    - npm --version
    - cd nmide-core
    - npm i
    - npm run test

c-test:
  dependencies:
    - c-test-build
  allow_failure: true
  image: neelzee/nmide-c:latest
  stage: test
  script:
    - exit
    - cd nmide-lib/debug
    - ls
    - ./test_cmap
    - ./test_cmodel
    - ./test_cmsg
  needs:
    - job: c-test-build
      artifacts: true

test-nmide-plugins:
  image: neelzee/nmide-rust:latest
  stage: test
  tags:
    - nmide-core
  script:
    - cargo --version
    - cd nmide-plugin
    - pwd
    - cargo test

test-nmide-wrapper:
  image: neelzee/nmide-wrapper:latest
  dependencies:
    - c-test-build
  stage: test
  script:
    - exit
    - cmake --version
    - cargo --version
    - cd nmide-wrapper/nmide-rust-ffi
    - cargo test
  needs:
    - job: c-test-build
      artifacts: true
